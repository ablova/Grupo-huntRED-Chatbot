<!-- Ubicacion SEXSI -- /home/pablollh/app/sexsi/templates/sign_agreement.html -->

{% extends "base.html" %}
{% block content %}
<h1 align="center">Firmar Acuerdo SEXSI</h1>
<p>Para garantizar la mayor validez legal, se registrarán detalles como la ubicación, fecha y hora de ambas partes.</p>

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}

<p>Firmando como: <strong>
    {% if signer == "creator" %}Creador - {{ agreement.creator.username }}
    {% else %}Invitado - {{ agreement.invitee_contact }}
    {% endif %}
</strong></p>

<h2>📸 Paso 1: Subir Selfie con Identificación</h2>
<form id="selfieForm" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <label for="selfie">Toma una selfie con tu identificación oficial (INE o pasaporte):</label>
    <input type="file" name="selfie" id="selfie" accept="image/*" capture="user" required>
    <br>
    <img id="previewSelfie" src="#" alt="Vista previa de la selfie" style="display:none; max-width: 250px; margin-top: 10px;">
    <br>
    <button type="submit">Subir Selfie</button>
</form>

<h2>✍️ Paso 2: Firma Autógrafa</h2>
<p>Usa tu dedo o un stylus para firmar en el recuadro. Se registrará tu ubicación.</p>
<div id="signature-container">
    <canvas id="biometricCanvas"></canvas>
</div>
<button id="clearBiometric">🗑 Limpiar Firma</button>
<button id="sendBiometric">Enviar Firma</button>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let selfieInput = document.getElementById("selfie");
        selfieInput.addEventListener("change", function (event) {
            let reader = new FileReader();
            reader.onload = function () {
                let img = document.getElementById("previewSelfie");
                img.src = reader.result;
                img.style.display = "block";
            };
            reader.readAsDataURL(event.target.files[0]);
        });
    });
</script>
{% endblock %}
